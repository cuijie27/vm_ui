<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title></title>
    <script src="../js/mui.min.js"></script>
    <script src="../js/Long.min.js"></script>
	<script src="../js/ByteBufferAB.min.js"></script>
	<script src="../js/ProtoBuf.noparse.min.js"></script>
	<script src="../js/Suowen.js"></script>
	<script src="../js/mui.poppicker.js"></script>
	<script src="../js/mui.listpicker.js"></script>
    <link href="../css/mui.min.css" rel="stylesheet"/>
    <!--App自定义的css-->
	<link href="../css/mui.listpicker.css" rel="stylesheet" />
	<link href="../css/mui.poppicker.css" rel="stylesheet" />
	<style>
		.mui-btn {
			font-size: 16px;
		}
		h5.mui-content-padded {
			margin-left: 3px;
			margin-top: 20px !important;
		}
		h5.mui-content-padded:first-child {
			margin-top: 12px !important;
		}
		.ui-alert {
			text-align: center;
			padding: 20px 10px;
			font-size: 16px;
		}
	</style>
    <script type="text/javascript" charset="utf-8">
      	mui.init();
    </script>
</head>
<body>
	<header class="mui-bar mui-bar-nav">
		<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
		<h1 class="mui-title">用户注册</h1>
	</header>

	<div class="mui-content">
		<div class="mui-content-padded" style="margin: 5px;">
			<h5>企业名称<font color="#FF0000" size="4">*</font>：</h5>
			<div class="mui-input-row">
				<input id="companyName" class="mui-input-clear" type="text" placeholder="企业名称">
			</div>
			<h5>负责人<font color="#FF0000" size="4">*</font>：</h5>
			<div class="mui-input-row">
				<input id="personInCharge" class="mui-input-clear" type="text" placeholder="负责人">
			</div>
			<h5>联系电话<font color="#FF0000" size="4">*</font>：</h5>
			<div class="mui-input-row">
				<input id="cellphoneNum" class="mui-input-clear" type="text" placeholder="联系电话">
			</div>
			<h5>渠道主营<font color="#FF0000" size="4">*</font>：</h5>
			<button id='showChannelPicker' class="mui-btn " style="width: 100%;" type='button'>选择所属渠道 ...</button>
			<div id='channelResult' class="ui-alert"></div>
		</div>
	</div>
	
	<script>
		
		function plusReady(){
			
		//var dataStr = "in plus ready [";
        //初始化API
        suowen.api.Init("http://suowen.ganshane.com");
        //添加协议文件
        suowen.api.AddProto("/sys/DicQuery.json");
        //编译api成JS调用对象
        var root = suowen.api.Build();

        var dicQueryRequest = new root.sys.DicQueryRequest()
        dicQueryRequest.setDic(root.sys.Dic.INDUSTRY);
        dicQueryRequest.setFields("id,name");

        //执行API操作,TODO 结合MUI自动出现loading效果
        suowen.api.Fetch(dicQueryRequest,function(response){
        	var dataStr = "[";	
            var data = response.getData();
            for(var i=0;i<data.length;i++){
            	var elementStr = "{";
                var e = data[i].getObject();
                for(var j=0;j<e.length;j++){
                	
                	if (j == 0){
                		elementStr += "value: \'";
                		elementStr += e[j].getValue();
                		elementStr += "\',";
                	}else if (j==1){
                		elementStr += "text: \'";
                		elementStr += e[j].getValue();
                		elementStr += "\'";
                	}
                	
                    //console.log(e[j].getKey());
                    //console.log(e[j].getValue());
                }
                elementStr += "}";
                if(i < data.length - 1)
                	elementStr += ",";
                
                //console.log("element str is "+elementStr);
                
                dataStr += elementStr;
            }
            
            dataStr += "]";
        	console.log("data str is "+dataStr);
        	
        	
        	
		        (function($, doc) {
				$.init();
				$.ready(function() {
					//普通示例
					var userPicker = new $.PopPicker();
					userPicker.setData(eval(dataStr));
					var showChannelPicker = doc.getElementById('showChannelPicker');
					var channelResult = doc.getElementById('channelResult');
					showChannelPicker.addEventListener('tap', function(event) {
						userPicker.show(function(items) {
							channelResult.innerText = JSON.stringify(items[0]);
						});
					}, false); 
				});
			})(mui, document);
	
	
        },function(message){
            alert(message);
        });
        
        
        
        
    };

        plusReady();

        
	
		</script>
</body>
</html>